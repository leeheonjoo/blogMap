<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.BoardReadMapper">
	<select id="getData" resultType="com.java.boardRead.dto.BoardReadDto">
		select *
		  from category
		 where category_code='200300'
	</select>
	
	<select id="getSidoCondition" resultType="String">
		select distinct loc_sido
		  from location_info
		 order by 1
	</select>
	
	<select id="getHeaderCondition" resultType="String">
		select distinct category_mname
		  from category
		 order by 1
	</select>
	
	<select id="getGunLocationCondition" parameterType="String" resultType="String">
		select distinct nvl(loc_sigugun, 'blank')
		  from location_info
		 where loc_sido = #{siData}
		 order by 1
	</select>
	
	<select id="getDongLocationCondition" parameterType="java.util.HashMap" resultType="String">
		select distinct loc_dongri
		  from location_info
		 where loc_sido = #{siData}
		   and nvl(loc_sigugun,'%') like '%'||#{gunData}||'%'
		 order by 1
	</select>
	
	<select id="getDetailCategoryCondition" parameterType="String" resultType="String">
		select distinct category_sname
		  from category
		 where category_MName=#{headData}
		   and category_sub != '000'
		 order by 1
	</select>
	
	<select id="getboardList" parameterType="java.util.HashMap" resultType="com.java.board.dto.BoardDto">
		<![CDATA[
		select * from board
		where board_no in(select board_no from 
		board_addr_info 
		where 
		(('%'=#{board_addr_info.addr_sido} and addr_sido like '%') or ('%'<>#{board_addr_info.addr_sido} and addr_sido = #{board_addr_info.addr_sido}))
		and (('%'=#{board_addr_info.addr_sigugun} and addr_sigugun like '%') or ('%'<>#{board_addr_info.addr_sigugun} and addr_sigugun = #{board_addr_info.addr_sigugun}))
		and (('%'=#{board_addr_info.addr_dongri} and addr_dongri like '%') or ('%'<>#{board_addr_info.addr_dongri} and addr_dongri = #{board_addr_info.addr_dongri})))
		and category_code in(select category_code 
		from category 
		where category_mname like '%'||#{category.category_mname}||'%'
		and category_sname like '%'||#{category.category_sname}||'%')
		and board_title like '%'||#{search_value}||'%'
        and board_content like '%'||#{search_value}||'%'
		]]>
	</select>
	
	<select id="blogSearchAddr" parameterType="java.util.HashMap" resultType="com.java.board.dto.Board_addr_infoDto">
	
	 	select distinct addr_sido,addr_sigugun,addr_dongri,addr_bunji 
	 	from board_addr_info 
	 	where board_no in
	  <foreach collection="boardList" item="item" index="index" open="(" separator="," close=")">
	  	  #{item.board_no}
	 </foreach>
	</select>
	
	<select id="blogListResult" parameterType="java.util.HashMap" resultType="com.java.board.dto.BoardDto">
		select board_no,member_id,category_code,board_rgdate,board_content,board_grade,board_count,board_title  
		from board
		where board_no in(select board_no 
		                  from board_addr_info 
		                  where addr_sido=#{sido} and addr_sigugun=#{sigugun} and addr_dongri=#{dongri} and addr_bunji=#{bunji})
		and board_title like '%'||#{searchValue}||'%'
		and board_content like '%'||#{searchValue}||'%'
	</select>
	<select id="getreply" parameterType="int" resultType="int">
		select count(*) from reply where board_no=#{board_no}
		
	</select>
	<select id="getReadList1" parameterType="int" resultType="java.util.HashMap">
		select b.*,r.reply_content,r.reply_date,A.ADDR_SIDO,A.ADDR_SIGUGUN,A.addr_dongri,a.addr_bunji,F.FILE_NO,f.file_type,F.FILE_NAME,F.FILE_SIZE,f.file_comment,f.file_path 
		from board b,board_addr_info a,reply r,attach_file f
		where b.board_no=r.board_no and r.board_no=a.board_no and a.board_no=f.board_no
		and b.board_no=#{board_no}
	</select>
	<select id="getReadList2" parameterType="int" resultType="java.util.HashMap">
		select  b.*,A.ADDR_SIDO,A.ADDR_SIGUGUN,A.addr_dongri,a.addr_bunji,F.FILE_NO,f.file_type,F.FILE_NAME,F.FILE_SIZE,f.file_comment,f.file_path 
		from board b,board_addr_info a,attach_file f 
		where b.board_no=a.board_no and a.board_no=f.board_no
		and b.board_no=#{board_no}
	</select>
</mapper>